<!-- 流量统计 Tab -->
<div class="tab-panel space-y-4" data-tab="traffic">
  <div class="grid grid-cols-3 gap-3">
    <div class="glass rounded-2xl p-4 stat-card" style="--accent-color:#22c55e">
      <p class="text-gray-500 text-xs mb-1">↑ 总上传</p>
      <p class="text-white text-lg font-bold"><%= formatBytes(globalTraffic.total_up) %></p>
    </div>
    <div class="glass rounded-2xl p-4 stat-card" style="--accent-color:#3b82f6">
      <p class="text-gray-500 text-xs mb-1">↓ 总下载</p>
      <p class="text-white text-lg font-bold"><%= formatBytes(globalTraffic.total_down) %></p>
    </div>
    <div class="glass rounded-2xl p-4 stat-card" style="--accent-color:#6366f1">
      <p class="text-gray-500 text-xs mb-1">📊 总流量</p>
      <p class="text-white text-lg font-bold"><%= formatBytes(globalTraffic.total_up + globalTraffic.total_down) %></p>
    </div>
  </div>
  <div class="glass rounded-2xl overflow-hidden">
    <div class="flex items-center justify-between p-4 border-b border-white/5">
      <h3 class="text-white text-sm font-medium">👥 用户流量排行</h3>
      <input type="date" id="traffic-date" value="<%= new Date().toISOString().slice(0,10) %>" onchange="loadTraffic(1)" class="bg-black/30 text-white text-xs px-3 py-1.5 rounded-lg border border-white/10">
    </div>
    <div class="overflow-x-auto max-h-64 overflow-y-auto">
      <table class="w-full text-sm text-left">
        <thead class="text-gray-500 border-b border-white/5 text-xs sticky top-0" style="background:rgba(15,11,30,0.9)">
          <tr><th class="py-2 px-4">用户</th><th class="py-2 px-4">↑ 上传</th><th class="py-2 px-4">↓ 下载</th><th class="py-2 px-4">总计</th></tr>
        </thead>
        <tbody class="text-gray-300" id="traffic-body">
          <% if (usersTraffic.rows.length === 0) { %>
            <tr><td colspan="4" class="py-6 px-4 text-gray-600 text-xs text-center">今日暂无流量数据</td></tr>
          <% } else { usersTraffic.rows.forEach(function(u) { %>
            <tr class="border-b border-white/5">
              <td class="py-2 px-4 text-xs"><%= u.username %></td>
              <td class="py-2 px-4 text-xs"><%= formatBytes(u.total_up) %></td>
              <td class="py-2 px-4 text-xs"><%= formatBytes(u.total_down) %></td>
              <td class="py-2 px-4 text-xs font-medium text-white"><%= formatBytes(u.total_up + u.total_down) %></td>
            </tr>
          <% }); } %>
        </tbody>
      </table>
    </div>
    <div class="flex items-center justify-between p-3 border-t border-white/5">
      <span class="text-gray-600 text-xs" id="traffic-info">共 <%= usersTraffic.total %> 人</span>
      <div class="flex gap-1" id="traffic-pager"></div>
    </div>
  </div>
</div>

<!-- 白名单 Tab -->
<div class="tab-panel space-y-4" data-tab="whitelist">
  <div class="glass rounded-2xl p-5">
    <div class="mb-4">
      <h3 class="text-white text-sm font-medium mb-1">🔓 节点白名单</h3>
      <p class="text-gray-500 text-xs">白名单用户无视节点等级限制，可获取全部节点</p>
    </div>
    <form method="POST" action="/admin/api/whitelist/add" class="flex gap-2 mb-4">
      <input type="hidden" name="_csrf" value="<%= csrfToken %>">
      <input type="text" name="username" placeholder="输入用户名" class="flex-1 bg-black/30 text-white px-4 py-2 rounded-xl border border-white/10 text-sm" required>
      <button class="bg-rose-600 hover:bg-rose-500 text-white px-4 py-2 rounded-xl text-sm transition">添加</button>
    </form>
    <div class="flex flex-wrap gap-2">
      <% whitelist.forEach(function(w) { %>
        <form method="POST" action="/admin/api/whitelist/remove" class="inline">
          <input type="hidden" name="_csrf" value="<%= csrfToken %>">
          <input type="hidden" name="nodeloc_id" value="<%= w.nodeloc_id %>">
          <button class="glass text-gray-300 px-3 py-1 rounded-full text-xs hover:bg-red-500/20 hover:text-red-300 transition"><%= w.username || ('ID:' + w.nodeloc_id) %> ✕</button>
        </form>
      <% }); %>
      <% if (whitelist.length === 0) { %><p class="text-gray-600 text-sm">白名单为空</p><% } %>
    </div>
  </div>
</div>
